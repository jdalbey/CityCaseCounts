<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Positive Case Counts by City over time.</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.bundle.js"></script>
<style>
td {
  border: 1px solid black;
}
.caption {
    font-family: sans-serif;
    text-align: center
}
</style>
<script>
// Utility to load the dynamic json file for highways, etc.
// Ref: https://codepen.io/KryptoniteDove/post/load-json-file-locally-using-pure-javascript
// Can also load .csv files
function loadJSON(inFile, callback)
{
    var xobj = new XMLHttpRequest();
    // Assume XML unless filename ends with .json
    if (inFile.endsWith(".json"))
    {
        xobj.overrideMimeType("application/json");
    }
    if (inFile.endsWith(".csv") || inFile.endsWith(".txt"))
    {
        xobj.overrideMimeType("text/csv");
    }
    xobj.open('GET', inFile, true);
    xobj.onreadystatechange = function()
    {
        if (xobj.readyState == 4 && xobj.status == "200")
        {
            callback(xobj.responseText);
        }
    };
    // We want ajax to ignore any cached responses
    xobj.setRequestHeader('If-Modified-Since', 'Sat, 01 Jan 2000 01:01:01 GMT')
    xobj.send(null);
}
function parseCSV(csvString, delimiter) 
{
    // Split the result to an array of lines
    var lines = csvString.split('\n');
    
    // Split the lines themselves by the specified
    // delimiter, such as a comma
    var result = lines.map(function(line) {
    	return line.split(delimiter);
    });
    
    return result;
}

</script>
<body>
<center><h3>Positive Case Counts by City over time.</h3></center>
<canvas id="myChart" width="200" height="200"></canvas>
<script>

var dayLabels;
var palette = [
"#9D44B5","#595F72","#42D9C8","#F5B841",
"#DAFF7D","#6C5A49","red","#A7C6DA",
"#2C8C99","#003F91","#23CE6B"]
var myarray;
var cityNames = [];
var cityCounts = [];
var datasets = [];
// Load the days that label the x axis
loadJSON("days.txt", function(csvstring) {
    dayLabels = parseCSV(csvstring,",");

    // load all the daily data
    loadJSON("cumulative.csv", function(csvstring) {
        myarray = parseCSV(csvstring,",");
        // Process each row (city)
	    for(i=0; i<myarray.length-1;i++)
        {
            var row = myarray[i]
            cityNames.push(row[0])
            cityCounts.push(row.slice(1))
            // define a chart item
            var item =  {"label":cityNames[i],
                    "data":cityCounts[i],
                    "fill":false,
                    "borderColor":palette[i],
                    "lineTension":0.1};
            datasets.push(item)
        }
        // Build the chart
        new Chart(document.getElementById("myChart"),
        {"type":"line",
         "data":
            {
            "datasets": datasets,
            "labels": dayLabels[0]
            },
         "options":{}
        });
    });
});
</script>
</body>
</html>
