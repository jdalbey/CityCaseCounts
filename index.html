<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Read CSV</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.bundle.js"></script>
<style>
td {
  border: 1px solid black;
}
.caption {
    font-family: sans-serif;
    text-align: center
}
</style>
<script>
// Load the dynamic json file for highways, etc.
// Ref: https://codepen.io/KryptoniteDove/post/load-json-file-locally-using-pure-javascript
// Can also load .csv files

function loadJSON(inFile, callback)
{
    var xobj = new XMLHttpRequest();
    // Assume XML unless filename ends with .json
    if (inFile.endsWith(".json"))
    {
        xobj.overrideMimeType("application/json");
    }
    if (inFile.endsWith(".csv") || inFile.endsWith(".txt"))
    {
        xobj.overrideMimeType("text/csv");
    }
    xobj.open('GET', inFile, true);
    xobj.onreadystatechange = function()
    {
        if (xobj.readyState == 4 && xobj.status == "200")
        {
            callback(xobj.responseText);
        }
    };
    // We want ajax to ignore any cached responses
    xobj.setRequestHeader('If-Modified-Since', 'Sat, 01 Jan 2000 01:01:01 GMT')
    xobj.send(null);
}
function parseCSV(csvString, delimiter) 
{
    // Split the result to an array of lines
    var lines = csvString.split('\n');
    
    // Split the lines themselves by the specified
    // delimiter, such as a comma
    var result = lines.map(function(line) {
    	return line.split(delimiter);
    });
    
    return result;
}

</script>
<body>
Positive Case Counts by City over time.
<canvas id="myChart" width="200" height="200"></canvas>
<script>

var dayLabels = [];
loadJSON("days.txt", function(csvstring) {
    dayLabels = parseCSV(csvstring,",");
    console.log(dayLabels);
});

var palette = ["#83ce6d","#e8d9b9","#ce6ba5","#5e1f4c","#4b5f20","#e8b9d0","#1f505e","#6aa1cd","#35822b","#434ec0"]
var myarray;
var cityNames = [];
var cityCounts = [];
var datasets = [];
loadJSON("cumulative.csv", function(csvstring) {
    myarray = parseCSV(csvstring,",");
	for(i=0; i<myarray.length-1;i++)
    {
        var row = myarray[i]
        cityNames.push(row[0])
        cityCounts.push(row.slice(1))
        var item =  {"label":cityNames[i],
                "data":cityCounts[i],
                "fill":false,
                "borderColor":palette[i],
                "lineTension":0.1};
        datasets.push(item)
    }
    console.log(cityNames);
    console.log(cityCounts[9]);
    new Chart(document.getElementById("myChart"),
    {"type":"line",
     "data":
        {
        "datasets": datasets,
        "labels": dayLabels
        },
     "options":{}
    });
});
</script>
</body>
</html>
